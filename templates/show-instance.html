<div ng-include src="'templates/header.html'"></div>
<div class="container-fluid">
<div class="row">
<div class="col-sm-8">

<div ng-show="raw">
		<legend>
		{{entity.label}}: {{raw.shorthand}}
		<span ng-if="parentLink">under
			<a ui-sref="{{kirraNG.toState(parentRelationship.typeRef.fullName, 'show')}}({ objectId: '{{parentLink.objectId}}' })">
				{{parentRelationship.label}} {{parentLink.shorthand}}
			</a>
		</span>
		</legend>
		<div ng-repeat="fieldData in fieldValues track by $index" ng-init="field = viewFields[$index]" class="form-horizontal">		
			<div ng-init="fieldName = field.name; typeName = field.typeRef.typeName; typeKind = field.typeRef.kind;" class="row">
				<div class="span4 display-values" class="form-group">
				    <div class="col-sm-3">
				        <label class="control-label" for="{{field.name}}">{{field.label}}:</label>
				    </div>
				    <div class="col-sm-9">
				        <ka-data slot="field" slot-data="fieldData" id="{{field.name}}"></ka-data>
				    </div>
				</div>
			</div>
		</div>
		
		<div ng-repeat="edge in edges | filter:{ relationshipStyle: 'CHILD'}">
			<h4>
				{{edge.relationshipLabel}}			
				<span class="badge">{{edge.rows.length}}</span>
				<a ng-click="createChild(edge.relationship, edge.relatedEntity)" ng-if="edge.relationship.editable">
			        <span class="glyphicon glyphicon-plus"></span>
			    </a>
			</h4>
            <div ng-include src="'templates/instance-table.html'" class="row" 
                ng-init="rows = edge.rows; tableProperties = edge.relatedTableProperties; actions = edge.relatedInstanceActions; performInstanceActionOnRow = edge.performRelatedInstanceActionOnRow; inlineActions = true">
            </div>
			<span ng-show="edge.rows.length == 0" class="label label-info span2 text-center">No records for {{edge.relationshipLabel}}</span>
		</div>
		
</div>
<div ng-show="raw==undefined">Loading...</div>
</div>
<div class="col-sm-4">
    <div class="row">
          <div class="btn-group" role="group">
              <button type="button" class="btn btn-default" ng-click="edit()" ng-if="editable && instanceCapabilities.instance.indexOf('Update') >= 0">
                  Edit
              </button>
              <button type="button" class="btn btn-default" ng-click="delete()" ng-if="instanceCapabilities.instance.indexOf('Delete') >= 0">
                  Delete
              </button>
          </div>
          <div class="btn-group" role="group">
              <button ng-repeat="action in actionEnablement.enabledActions" ng-if="instanceCapabilities.actions[action.name].indexOf('Call') >= 0" type="button" class="btn btn-default" ng-click="performAction(action)">
                  {{action.label}}
              </button>
          </div>
    </div>
    <div class="row">
		<div ng-repeat="edge in edges | filter:{ relationshipStyle: 'LINK'}">
			<h4>{{edge.relationshipLabel}}
			    <span class="badge">{{edge.rows.length}}</span>
			    <a ng-click="link(edge.relationship, edge.relatedEntity)" ng-if="!edge.relationship.oppositeReadOnly && !edge.relationship.oppositeRequired">
			        <span ng-if="edge.relationship.editable" class="glyphicon glyphicon-plus"></span>
			    </a>
		    </h4>
			<div>
			<div ng-repeat="row in edge.rows"> 
			        <a ui-sref="{{kirraNG.toState(row.raw.typeRef.fullName, 'show')}}({ objectId: '{{row.raw.objectId}}' })">{{row.raw.shorthand}}</a>
				    <a sref="$state.get()" ng-click="unlink(edge.relationship, row.raw.typeRef.fullName, row.raw.objectId)" ng-if="edge.relationship.editable && !edge.relationship.oppositeReadOnly && !edge.relationship.oppositeRequired">
				        <span class="glyphicon glyphicon-minus" style="color: #D00020"></span>
				    </a>
			</div>
			</div>
		</div>
	</div>
</div>
</div>